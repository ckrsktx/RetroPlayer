<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover"/>
<title>Retro Player</title>
<style>
  :root{ --accent:#fff; --bg:#000; --fg:#fff }
  *{ box-sizing:border-box; margin:0; padding:0; -webkit-tap-highlight-color:transparent }
  html,body{ height:100%; overflow:hidden; background:var(--bg); color:var(--fg); font-family:system-ui; display:flex; flex-direction:column; align-items:center; text-align:center }
  #top{ flex:0 0 auto; height:env(safe-area-inset-top) }
  #wrap{ flex:1; width:100%; overflow:auto; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:0 1rem 1rem }
  #capaWrap{ position:relative; width:min(45vw,9rem); aspect-ratio:1; overflow:hidden; box-shadow:0 0 1.2rem var(--accent); margin-bottom:1rem }
  #capa{ width:100%; height:100%; object-fit:cover }
  #disco{ position:absolute; inset:0; background:#111; display:flex; align-items:center; justify-content:center; opacity:0; transition:opacity .3s }
  #disco svg{ width:50%; height:50%; stroke:#444; stroke-width:1; fill:none }
  #bar{ display:flex; gap:.8rem; margin-bottom:.8rem; align-items:center }
  .btn{ width:2.4rem; height:2.4rem; background:rgba(255,255,255,.08); border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer }
  .btn svg{ width:1.1rem; height:1.1rem; stroke:var(--fg); stroke-width:1.5; fill:none }
  .btn.on{ background:var(--accent); color:var(--bg) }
  #info{ margin-bottom:.6rem }
  #tit{ font-size:1rem; font-weight:600; letter-spacing:.5px; margin-bottom:.1rem }
  #art{ opacity:.7; font-size:.85rem }
  #bubbles{ display:flex; gap:.4rem; flex-wrap:wrap; justify-content:center; margin-bottom:.6rem }
  .bubble{ padding:.25rem .6rem; border:1px solid var(--accent); border-radius:2rem; font-size:.7rem; cursor:pointer; transition:background .2s }
  .bubble.on{ background:var(--accent); color:var(--bg) }
  #roleta{ width:100%; max-height:35vh; overflow:auto; list-style:none }
  li{ display:flex; flex-direction:column; padding:.3rem 0; cursor:pointer; gap:.1rem }
  li .mus{ font-size:.95rem; color:var(--fg) }
  li .art{ font-size:.75rem; color:#aaa }
  li.on{ color:var(--accent) }
  footer{ width:100%; padding:.4rem 0; font-size:.55rem; opacity:.4; letter-spacing:1px }
</style>
</head>
<body>

<div id="top"></div>

<div id="wrap">

  <div id="capaWrap">
    <img id="capa" src="https://i.imgur.com/4GqCIYM.png"/>
    <div id="disco">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="#444" stroke-width="1" fill="none"/><circle cx="12" cy="12" r="3" stroke="#444" stroke-width="1" fill="none"/></svg>
    </div>
  </div>

  <div id="bar">
    <div class="btn" id="prev"><svg viewBox="0 0 24 24"><path d="M19 20L9 12l10-8v16zM5 4v16"/></svg></div>
    <div class="btn" id="playBtn"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
    <div class="btn" id="next"><svg viewBox="0 0 24 24"><path d="M5 4l10 8-10 8V4zm14 0v16"/></svg></div>
    <div class="btn" id="shufBtn"><svg viewBox="0 0 24 24"><path d="M16 3h5v5M4 20L21 3m0 13v5h-5M4 4l5 5"/></svg></div>
  </div>

  <div id="info">
    <div id="tit">–</div>
    <div id="art">–</div>
  </div>

  <div id="bubbles"></div>
  <ul id="roleta"></ul>

</div>

<footer>RETRO PLAYER</footer>

<audio id="a" preload="metadata"></audio>

<script>
/* ---------- CONFIG ---------- */
const API_KEY = '685a04193652e98c9e5e598dc6d306ab';
const PLAYLISTS = {
  Alternative: 'https://raw.githubusercontent.com/ckrsktx/PlayerX/refs/heads/main/AlternativeNow.json',
  '1990s':     'https://raw.githubusercontent.com/ckrsktx/PlayerX/refs/heads/main/1990s.json'
};
/* ---------------------------- */

const $ = s => document.querySelector(s);
const a = $('#a'), capa = $('#capa'), disco = $('#disco'), tit = $('#tit'), art = $('#art'), playBtn = $('#playBtn'), prev = $('#prev'), next = $('#next'), shufBtn = $('#shufBtn'), roleta = $('#roleta'), bubbles = $('#bubbles');
let q = [], idx = 0, shuf = false, currentPl = 'Alternative';

/* ---------- CAPA + COR DINÂMICA ---------- */
async function loadTrack() {
  const t = q[idx];
  a.src = t.url;
  tit.textContent = t.title;
  art.textContent = t.artist;
  /* capa + cor */
  try {
    const url = `https://ws.audioscrobbler.com/2.0/?method=track.getInfo&api_key=${API_KEY}&artist=${encodeURIComponent(t.artist)}&track=${encodeURIComponent(t.title)}&format=json`;
    const img = (await (await fetch(url)).json())?.track?.album?.image?.find(x => x.size === 'extralarge')?.['#text'];
    if (img) {
      capa.src = img;
      disco.style.opacity = 0;
    } else {
      capa.src = '';
      disco.style.opacity = 1;
    }
  } catch {
    capa.src = '';
    disco.style.opacity = 1;
  }
  markOnly();
}

/* ---------- PLAY/PAUSE ---------- */
playBtn.onclick = () => {
  a.paused ? a.play() : a.pause();
  updateIcon();
};
function updateIcon() {
  playBtn.innerHTML = a.paused
    ? '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>'
    : '<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
}

/* ---------- CONTROLES ---------- */
prev.onclick = () => skip(-1);
next.onclick = () => skip(1);
shufBtn.onclick = () => {
  shuf = !shuf;
  shufBtn.classList.toggle('on', shuf);
  loadPl();
};
function skip(d) {
  idx = (idx + d + q.length) % q.length;
  loadTrack();
  a.play();
}

/* ---------- MARCA SÓ QUEM TOCA ---------- */
function markOnly() {
  document.querySelectorAll('li').forEach((li, i) => li.classList.toggle('on', i === idx));
}

/* ---------- BOLHAS ---------- */
Object.keys(PLAYLISTS).forEach(pl => {
  const b = document.createElement('span');
  b.className = 'bubble';
  b.textContent = pl;
  b.onclick = () => {
    document.querySelectorAll('.bubble').forEach(x => x.classList.remove('on'));
    b.classList.add('on');
    currentPl = pl;
    loadPl();
  };
  if (pl === currentPl) b.classList.add('on');
  bubbles.append(b);
});

/* ---------- LOAD PLAYLIST ---------- */
async function loadPl() {
  q = await (await fetch(PLAYLISTS[currentPl])).json();
  if (shuf) q = [...q].sort(_ => Math.random() - .5);
  idx = 0;
  renderRoleta();
  loadTrack();
  a.pause(); // aguarda play do usuário
  updateIcon();
}

/* ---------- ROLETA ---------- */
function renderRoleta() {
  roleta.innerHTML = '';
  q.forEach((t, i) => {
    const li = document.createElement('li');
    li.innerHTML = `<span class="mus">${t.title}</span><span class="art">${t.artist}</span>`;
    li.onclick = () => { idx = i; loadTrack(); a.play(); };
    roleta.append(li);
  });
  markOnly();
}

/* ---------- AUDIO EVENTS ---------- */
a.onplay = updateIcon;
a.onpause = updateIcon;
a.onended = () => { idx = (idx + 1) % q.length; loadTrack(); a.play(); };

/* ---------- START ---------- */
loadPl();
</script>
</body>
</html>
